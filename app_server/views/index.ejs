<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { height: 100%; }
      #drop_down{
        height:100px;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>

  </head>
  <body>
    <div id=drop_down>
        <select name="type" id="type">
          <!-- <option value="all">ALL TYPES</option> -->
        </select>
        <select name="description" id="description">
          <option value="All Subtypes">ALL SUBTYPES</option>
        </select>
    </div>

    <div id="map"></div>
    <script type="text/javascript">

    var lats=[];
    var longs=[];
    var map;
    var markers=[];

    $(document).ready(function(){
      var arr = [];
      var arrSec = [];
      console.log('jquery is ready');

      $.ajax({
        url:'https://data.cityofchicago.org/resource/ijzp-q8t2.json',
        type:'get',
        success:function(data){
          // console.dir(data);
          // console.dir(data[0]['primary_type']);
          fillCrimeSelector('#type','primary_type',data);
          console.log($('option:selected').val());
          for(var crime in data){
              // if($('option:selected').val()=='all'){
              //   addMarker(data[crime]);
              // }
             if(data[crime].primary_type==$('option:selected').val()){
              //  console.log(data[crime]);
               addMarker(data[crime]);
              //  console.log(markers);
            };//end of if statment
          }//end of for in loop

/////////////////////////change event listener
          $('select').change(function(){
            // console.log($('option:selected').val());
            // console.log('yay!');
            removeMarkers(markers);
            redrawMap();
          });//option:selected .change event listener
//////////////////////////////////////////////////////
        },
        error:function(err){
          console.log(err);
        }
      });//end of ajax call
    });//end of document.ready

///////////function definitions//////////////////////

function addMarker (data){
  var marker = new google.maps.Marker({
    position: {lat:parseFloat(data.latitude),lng:parseFloat(data.longitude)},
    map: map,
    icon:'http://megaicons.net/static/img/icons_sizes/15/534/32/map-marker-ball-left-pink-icon.png',
    title: data.primary_type+' ---- '+data.description+' ---- '+data.date,
    animation:google.maps.Animation.DROP
  });// end of marker constructor
  markers.push(marker);
}

function removeMarkers(arr){
  for(var i in arr){
    arr[i].setMap(null);
  }
}
function redrawMap(){
  var arr=[];
  var arrDes=[];
  $.ajax({
    url:'https://data.cityofchicago.org/resource/ijzp-q8t2.json',
    type:'get',
    success:function(data){
      // console.dir(data);
      for(var crime in data){
        if(arr.indexOf(data[crime].primary_type) == -1){
          arr.push(data[crime].primary_type);
          // console.log('new type!', data[crime].primary_type);
          // $('#type').append('<option id="'+data[crime].primary_type+'" value="'+data[crime].primary_type+'">'+data[crime].primary_type+'</option>');
        }//end of if statment

         if(data[crime].primary_type==$('option:selected').val()){
          //  console.log(data[crime]);
           addMarker(data[crime]);
          //  console.log(markers);

        };//end of if statment
      }//end of for-loop
    },
    error:function(err){
      console.log(err);
    }
  });//end of $.ajax

}//end of draw map function

function initMap() {
  var myLatLng = {lat: 41.845652363, lng: -87.636561415};

   map = new google.maps.Map(document.getElementById('map'), {
    zoom: 10,
    center: myLatLng
  });
}//end of initMap function

function fillCrimeSelector(id,field,data){
  var arr=[];
  var desc=[];
  for(var crime in data){
    // console.dir(data[crime][field]);
    if(arr.indexOf(data[crime][field]) == -1){
      arr.push(data[crime][field]);
      // console.log('new type!', data[crime][field]);
        $(id).append('<option id="'+data[crime][field]+'" value="'+data[crime][field]+'">'+data[crime][field]+'</option>');

    }//end of if statment

  }//end of for-in loop

}//end of fillSelector function

$.post('/api',{name:'Terry'}, function(data){
  console.log(data);
});

    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCg6XUTd5Bh0CNhz8vyaEjeTUSaVckCZ5A&callback=initMap">
    </script>
  </body>
</html>
